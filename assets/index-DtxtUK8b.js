(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();class k{constructor(){this.DEFAULT_CONFIG={expires:"1d",path:"; path=/"}}config(e){e.expires&&(this.DEFAULT_CONFIG.expires=e.expires),e.path===""?this.DEFAULT_CONFIG.path="":this.DEFAULT_CONFIG.path="; path="+e.path}get(e){let t=decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;if(t&&t.startsWith("{")&&t.endsWith("}"))try{t=JSON.parse(t)}catch{return t}return t}set(e,t,i={}){if(e){if(/^(?:expires|max\-age|path|domain|secure)$/i.test(e))throw new Error("cookie key name illegality ,Cannot be set to ['expires','max-age','path','domain','secure']	current key name: "+e)}else throw new Error("cookie name is not find in first argument");t&&t.constructor===Object&&(t=JSON.stringify(t));let n="; max-age=86400",r=i.expires||this.DEFAULT_CONFIG.expires;if(r)switch(r.constructor){case Number:r===1/0||r===-1?n="; expires=Fri, 31 Dec 9999 23:59:59 GMT":n="; max-age="+r;break;case String:if(/^(?:\d{1,}(y|m|d|h|min|s))$/i.test(r)){let u=r.replace(/^(\d{1,})(?:y|m|d|h|min|s)$/i,"$1");switch(r.replace(/^(?:\d{1,})(y|m|d|h|min|s)$/i,"$1").toLowerCase()){case"m":n="; max-age="+ +u*2592e3;break;case"d":n="; max-age="+ +u*86400;break;case"h":n="; max-age="+ +u*3600;break;case"min":n="; max-age="+ +u*60;break;case"s":n="; max-age="+u;break;case"y":n="; max-age="+ +u*31104e3;break}}else n="; expires="+r;break;case Date:n="; expires="+r.toUTCString();break}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+n+(i.domain?"; domain="+i.domain:"")+(i.path?"; path="+i.path:this.DEFAULT_CONFIG.path)+(i.secure?"; secure":""),this}remove(e,t={}){return!e||!this.isKey(e)?!1:(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t.domain?"; domain="+t.domain:"")+(t.path?"; path="+t.path:this.DEFAULT_CONFIG.path),this)}isKey(e){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}keys(){if(!document.cookie)return[];for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=0;t<e.length;t++)e[t]=decodeURIComponent(e[t]);return e}}const a={url:"http://localhost:8000",todos:"todos",create:"create",update:"update",del:"delete",login:"auth/login",register:"users/register",auth:"auth",refresh:"refresh"},$=async()=>{try{const o=await fetch(`${a.url}/${a.todos}`,{method:"POST",headers:{Authorization:`Bearer ${y("accessToken")}`}});if(!o.ok)throw new Error(`Response status: ${o.status}`);return await o.json()}catch(o){return console.error(o),!1}},x=async o=>{try{const e=await fetch(`${a.url}/${a.todos}/${a.create}`,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json",Authorization:`Bearer ${y("accessToken")}`}});if(!e.ok)throw new Error("Failed to add todo");return await e.json()}catch(e){return console.error(e),!1}},v=async(o,e)=>{try{const t=await fetch(`${a.url}/${a.todos}/${a.update}/${e}`,{method:"PUT",body:JSON.stringify(o),headers:{"Content-Type":"application/json",Authorization:`Bearer ${y("accessToken")}`}});if(!t.ok)throw new Error("Failed to update todo");return await t.json()}catch(t){return console.error(t),!1}},C=async o=>{try{const e=await fetch(`${a.url}/${a.todos}/${a.del}/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${y("accessToken")}`}});if(!e.ok)throw new Error("Failed to Delete todo");return await e.json()}catch(e){return console.error(e),!1}},L=async()=>{try{const o=await fetch(`${a.url}/${a.auth}/${a.refresh}`,{method:"POST",headers:{Authorization:`Bearer ${y("refreshToken")}`}});if(!o.ok)throw new Error("Failed to Delete todo");return await o.json()}catch(o){return console.error(o),!1}};async function f(o,...e){const t=await o(...e);if(!t)return{status:401};if(t.status!=200){const i=await L();if(i.status!=200)return{status:401};w(i.data,y("refreshToken"));const n=await o(...e);return n?{status:200,data:n.data}:{status:401}}else return{status:200,data:t.data}}const h=new k;function w(o,e){h.set("accessToken",o),h.set("refreshToken",e)}function y(o){return h.get(o)}function D(){h.remove("accessToken"),h.remove("refreshToken")}document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("loginForm"),e=document.getElementById("loginMessage");o.addEventListener("submit",async c=>{c.preventDefault();const s=document.getElementById("email").value,m=document.getElementById("password").value;if(document.getElementById("submitButton").innerText=="Login")try{const l=await fetch(`${a.url}/${a.login}`,{method:"POST",body:JSON.stringify({email:s,password:m}),headers:{"Content-Type":"application/json"}});if(!l.ok)throw e.innerText="Network response was not ok",new Error("Network response was not ok");const d=await l.json();if(!(d.accessToken&&d.refreshToken))throw new Error(d);w(d.accessToken,d.refreshToken),document.getElementById("login-container").style.display="none",document.getElementById("main-container").style.display="flex",r()}catch(l){console.error("Error Logging In:",l),e.innerText="Invalid Credentials"}else try{const l=document.getElementById("name").value,d=await fetch(`${a.url}/${a.register}`,{method:"POST",body:JSON.stringify({name:l,email:s,password:m}),headers:{"Content-Type":"application/json"}});if(!d.ok)throw e.innerText="Network response was not ok",new Error("Network response was not ok");const p=await d.json();e.innerText=p}catch(l){console.error("Error Registering:",l),e.innerText="User Already Exists"}}),document.getElementById("switchButton").addEventListener("click",async function(){document.getElementById("switchButton").innerText=="Login"?(document.getElementById("form-title").textContent="Login",document.getElementById("name-input-div").style.display="none",document.getElementById("name").style.display="none",document.getElementById("submitButton").innerText="Login",document.getElementById("switchButton").innerText="Register"):(document.getElementById("form-title").textContent="Register",document.getElementById("name-input-div").style.display="flex",document.getElementById("name").style.display="block",document.getElementById("submitButton").innerText="Register",document.getElementById("switchButton").innerText="Login")});function t(){document.getElementById("login-container").style.display="block",document.getElementById("main-container").style.display="none",D()}var i=[],n=null;document.getElementById("logout").addEventListener("click",()=>{t()});async function r(){const c=await f($);c.status==200?(i=c.data,u()):t()}function u(){const c=document.getElementById("todosList");c.innerHTML="",i.forEach(s=>{const m=document.createElement("div");m.className="todo-item";const l=document.createElement("div");l.innerHTML=`
          <strong>${s.title}</strong> - ${s.description} - ${s.dueDate} - ${s.priority} - ${s.category}
      `;const d=document.createElement("div"),p=document.createElement("button");p.innerText="Delete",p.onclick=()=>I(s.id);const g=document.createElement("button");g.innerText="Edit",g.onclick=()=>B(s.id),d.appendChild(g),d.appendChild(p),m.appendChild(l),m.appendChild(d),c.appendChild(m)})}async function T(){const c=document.getElementById("title").value,s=document.getElementById("description").value,m=document.getElementById("dueDate").value,l=document.getElementById("priority").value,d=document.getElementById("category").value;if(c&&s&&m&&l&&d){const p={title:c,description:s,completed:!1,dueDate:m,priority:l,category:d};n?((await f(v,p,n)).status==200?(document.getElementById("add-todo").innerHTML="Add Todo",r(),E()):t(),n=null):(await f(x,p)).status==200?(r(),E()):t()}else alert("Please fill in all fields")}async function I(c){(await f(C,c)).status==200?r():t()}async function B(c){const s=i.find(({id:m})=>m==c);document.getElementById("title").value=s.title,document.getElementById("description").value=s.description,document.getElementById("dueDate").value=s.dueDate,document.getElementById("priority").value=s.priority,document.getElementById("category").value=s.category,document.getElementById("add-todo").innerHTML="Edit Todo",n=c}function E(){document.getElementById("title").value="",document.getElementById("description").value="",document.getElementById("dueDate").value="",document.getElementById("priority").value="High",document.getElementById("category").value=""}document.getElementById("add-todo").addEventListener("click",()=>{T()})});
